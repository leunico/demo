{extend name="common@public/open" /}
{block name="main"}
<blockquote class="layui-elem-quote layui-text" style="margin-top:12px;">
    添加或编辑一个接口
</blockquote>
<div class="layui-tab-content">
    <form class="layui-form" action="">
        <input type="hidden" name="project_Id" value="{$project_Id}"/>
        <fieldset class="layui-elem-field layui-field-title" style="margin-top:0px;">
            <legend style="margin-left:27px;">接口基本信息</legend>
        </fieldset>
        <div class="layui-form-item">
            <label class="layui-form-label">选择分组</label>
            <div class="layui-input-inline">
                <select name="group_Parent" lay-filter="group_Parent">
                    {:apiGroupSelect($project_Id, $group_Id)}
                </select>
            </div>
            <div class="layui-input-inline">
                <select name="group_Child" lay-filter="group_Child">
                    <option value=0>-可不设置子分组-</option>
                </select>
            </div>
            <label class="layui-form-label">是否启用</label>
            <div class="layui-input-inline">
                <div class="layui-input-block" style="margin-left:0px;">
                <input type="checkbox" value="1" name="interface_Status" lay-skin="switch" lay-filter="switchTest" lay-text="启用|弃用" {if condition="$interface_Status eq 1"}checked{/if}>
            </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">接口名称</label>
            <div class="layui-input-block">
                <input type="text" name="interface_Name" lay-verify="required" placeholder="请输入接口名称" autocomplete="off" class="layui-input" value="{$interface_Name}">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">接口链接</label>
            <div class="layui-input-inline" style="width:10%;">
                <select name="interface_Method" lay-filter="methon" lay-verify="required">
                    {volist name=":getConfigModel('interface_method')" id="vo"}
                        <option value="{$vo}" {eq name="vo" value="$interface_Method"}selected{/eq}>{$vo}</option>
                    {/volist}
                </select>
            </div>
            <div class="layui-input-block" style="width:79.2%;display:inline-block;margin-left:-10px;">
                <input type="text" name="interface_Url" lay-verify="required" placeholder="请输入接口链接" autocomplete="off" class="layui-input" value="{$interface_Url}">
            </div>
        </div>
        <fieldset class="layui-elem-field layui-field-title" style="margin-top:0px;">
            <legend style="margin-left:27px;">请求头部信息</legend>
        </fieldset>

        <!-- <div class="layui-form-item" data-id="1">
            <div class="layui-inline-block">
            <div class="layui-input-inline">
                <select name="header_key" lay-verify="required" lay-search="">
                    <option value="">添加或者选择键类型</option>
                    <option value="1">layer</option>
                    <option value="2">form</option>
                    <option value="3">layim</option>
                    <option value="4">element</option>
                    <option value="5">laytpl</option>
                    <option value="6">upload</option>
                    <option value="7">laydate</option>
                    <option value="8">laypage</option>
                </select>
            </div>
            <div class="layui-input-inline">
                <input type="text" name="header_value" lay-verify="required" placeholder="请输入内容" autocomplete="off" class="layui-input" value="" onchange="eventHeader(this)">
            </div>
            <div class="layui-input-inline" style="width:45%;">
                <input type="text" name="header_remark" placeholder="请输入说明" autocomplete="off" class="layui-input" value="">
            </div>
            <div class="layui-input-inline" style="width:10%;">
                <a href="javascript:"><span class="layui-badge layui-bg-gray layui-badge-font"><i class="fa fa-trash-o" style="font-size:1.4em;"></i></span></a>
                <a href="javascript:"><span class="layui-badge layui-bg-gray layui-badge-font"><i class="fa fa-angle-double-down" style="font-size:1.4em;"></i></span></a>
                <a href="javascript:"><span class="layui-badge layui-bg-gray layui-badge-font"><i class="fa fa-angle-double-up" style="font-size:1.4em;"></i></span></a>
            </div>
            </div>
        </div>

        <div class="layui-form-item" data-id="2">
            <div class="layui-inline-block">
                <div class="layui-input-inline">
                    <select name="header_key" lay-verify="required" lay-search="">
                        <option value="">添加或者选择键类型</option>
                        <option value="1">layer</option>
                        <option value="2">form</option>
                        <option value="3">layim</option>
                        <option value="4">element</option>
                        <option value="5">laytpl</option>
                        <option value="6">upload</option>
                        <option value="7">laydate</option>
                        <option value="8">laypage</option>
                    </select>
                </div>
                <div class="layui-input-inline">
                    <input type="text" name="header_value" lay-verify="required" placeholder="请输入内容" autocomplete="off" class="layui-input" value="" onchange="eventHeader(this)">
                </div>
                <div class="layui-input-inline" style="width:45%;">
                    <input type="text" name="header_remark" placeholder="请输入说明" autocomplete="off" class="layui-input" value="">
                </div>
                <div class="layui-input-inline" style="width:10%;">
                    <a href="javascript:"><span class="layui-badge layui-bg-gray layui-badge-font"><i class="fa fa-trash-o" style="font-size:1.4em;"></i></span></a>
                    <a href="javascript:"><span class="layui-badge layui-bg-gray layui-badge-font"><i class="fa fa-angle-double-down" style="font-size:1.4em;"></i></span></a>
                    <a href="javascript:"><span class="layui-badge layui-bg-gray layui-badge-font"><i class="fa fa-angle-double-up" style="font-size:1.4em;"></i></span></a>
                </div>
            </div>
        </div> -->

        <div class="layui-form-item" data-id="1">
            <div class="layui-inline-block">
                <div class="layui-input-inline">
                    <select name="header_key[]" lay-verify="required" lay-search="">
                        <option value="">添加或者选择键类型</option>
                        <option value="1">layer</option>
                        <option value="2">form</option>
                        <option value="3">layim</option>
                        <option value="4">element</option>
                        <option value="5">laytpl</option>
                        <option value="6">upload</option>
                        <option value="7">laydate</option>
                        <option value="8">laypage</option>
                    </select>
                </div>
                <div class="layui-input-inline">
                    <input type="text" name="header_value[]" lay-verify="required" placeholder="请输入内容" autocomplete="off" class="layui-input" value="" onchange="eventHeader(this)">
                </div>
                <div class="layui-input-inline" style="width:45%;">
                    <input type="text" name="header_remark[]" placeholder="请输入说明" autocomplete="off" class="layui-input" value="">
                </div>
                <div class="layui-input-inline" style="width:10%;">
                    <a href="javascript:" onclick="delHeader(this)"><span class="layui-badge layui-bg-gray layui-badge-font"><i class="fa fa-trash-o" style="font-size:1.4em;"></i></span></a>
                    <a href="javascript:"><span class="layui-badge layui-bg-gray layui-badge-font"><i class="fa fa-angle-double-down" style="font-size:1.4em;"></i></span></a>
                    <a href="javascript:"><span class="layui-badge layui-bg-gray layui-badge-font"><i class="fa fa-angle-double-up" style="font-size:1.4em;"></i></span></a>
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block layui-input-submit">
                <button class="layui-btn layui-btn-small" lay-submit="group" lay-filter="group">立即保存</button>
                <button type="reset" class="layui-btn layui-btn-small layui-btn-primary">取消</button>
            </div>
        </div>
    </form>
</div>
{/block}

{block name="js"}
<script>
    var $ = layui.jquery;
    var h = 1;
var j=2;
var s;
function add(){
    var k=1;
    var de=document.getElementsByName("edutypeid2");
    for(var i=0;i<de.length;i++){
        if(de[i].value==$('edutypeid').value){
            k=0;
            alert('已经添加');
        }
    }

    if(k==1){
        var tea=$('edutypeid');
        var teacherid=$('edutypeid').value;
        var teacher=tea.options[tea.selectedIndex].text;
        var d = document.createElement("div");
        d.innerHTML="<a class=\"bt\" onclick=\"javascript:sort(this)\">"+teacher+"</a><input name=\"edutypeid2\" value=\""+teacherid+"\" type=\"hidden\"><input type=\"button\" onclick=\"del(this)\" value=\"删除\"/><br/>";
        //alert(d.innerHTML);
        $('de').appendChild(d);

    }
}
function del(v){
    var is=confirm('是否删除?');
    if(is){
        var x=v.parentNode;
        x.parentNode.removeChild(x);
    }
}
function sort(v){
    if(j%2==0){
        //v.style.cursor="move";
        s=v.parentNode.innerHTML;
        var x=v.parentNode;
        x.parentNode.removeChild(x);
    }else{
        var d = document.createElement("div");
        d.innerHTML=s;
        v.parentNode.parentNode.insertBefore(d,v.parentNode);
    }
    j++;
}
    function eventHeader(e){
        if(!$(e).attr("lay-verify")){
            $(e).attr('lay-verify', 'required');
            $(e).parent().prev().find('select').attr('lay-verify', 'required');
        }

        var item = $(e).parent().parent().parent();
        if(item.attr('data-id') == h){
            h++;
            item.after(item.prop("outerHTML"));
            var nextItem = item.next();
            nextItem.attr('data-id', h);
            nextItem.find('select').attr('lay-verify', '');
            nextItem.find("input[name='header_value[]']").attr('lay-verify', '');
        }
    }

    function delHeader(e){
        $(e).parent().parent().parent().remove();
    }

    layui.use(['form', 'jquery'], function(){
        var $ = layui.jquery,
            form = layui.form;

        form.on('select(group_Parent)', function(data){
            $.get("/project/api_group?gid=" + data.value, function(res){
                if(res.status == 1){
                    $html = '<option value=0>-可不设置子分组-</option>';
                    for(var key in res.data)
                        $html += '<option value=' + key + '>' + res.data[key] + '</option>'

                    $("select[name='group_Child']").html($html);
                    form.render('select');
                }else{
                    parent.layer.msg(res.msg, {time: 2000, icon: 2});
                }
            });
        });

        form.on('submit(group)', function(data){
            if(data.field.group_Id == 0){
                console.log(data.field);
//                $.post("/project/api_group", data.field, function(res){
//                    if(res.status == 1)
//                        parent.window.location.reload();
//                    else
//                        parent.layer.msg(res.msg, {time: 2000, icon: 2});
//                });
            }else{
                $.ajax({
                    url: "/project/api_group/" + data.field.group_Id,
                    type: "PUT",
                    data: data.field,
                    success: function(res){
                        if(res.status == 1)
                            parent.window.location.reload();
                        else
                            parent.layer.msg(res.msg, {time: 2000, icon: 2});
                    }
                });
            }
        });
    });
</script>
{/block}